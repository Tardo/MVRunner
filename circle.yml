# To Build MVRunner Reto Game
dependencies:
  pre:
    - |
        sudo apt-get update && sudo apt-get install -y cmake zlib1g-dev libfreetype6-dev libjpeg-dev libx11-dev libxrandr-dev libxcb1-dev libx11-xcb-dev libxcb-randr0-dev libxcb-image0-dev libflac-dev libogg-dev libvorbis-dev libvorbisenc2 libvorbisfile3 libopenal-dev libudev-dev libsndfile1-dev libglew-dev

        # The SFML available in repositories is older than v2.4.2...
        if [ ! -d ~/SFML-2.4.2 ]; then
          wget -O ~/sfmlv2.4.2.tar.gz https://github.com/SFML/SFML/archive/2.4.2.tar.gz
          tar -zxvf ~/sfmlv2.4.2.tar.gz -C ~/
        fi
        cd ~/SFML-2.4.2; cmake -DBUILD_SHARED_LIBS:BOOL=FALSE -DCMAKE_INSTALL_PREFIX:PATH=/usr . && make && sudo make install
        
        # libZpg (Too old gcc compiler)
        wget -O ~/zpgv1.0.0.zip https://github.com/Tardo/Zpg/archive/master.zip && unzip ~/zpgv1.0.0.zip -d ~/
        cd ~/Zpg-master; cmake -DCMAKE_BUILD_TYPE:STRING=Release -DCMAKE_INSTALL_PREFIX:PATH=/usr . && make Zpg && make zpg_packer && sudo make install
  cache_directories:
    - "~/SFML-2.4.2/"
    #- "~/ZPG-1.0.0/"

## Artifacts
general:
  artifacts:
    - "build-debug/MVRunner_d"
    - "build-release/MVRunner"
    #- "build-release/assets.zpg"

## Customize test commands
test:
  override:
    - |
        mkdir build-release/ && cd build-release/
        cmake -DCMAKE_BUILD_TYPE:STRING=Release .. && make && make create_zpg
        cpack --debug --verbose -C CPackConfig.cmake
    - |
        mkdir build-debug/ && cd build-debug/
        cmake -DCMAKE_BUILD_TYPE:STRING=Debug .. && make

  post:
    - mkdir $CIRCLE_ARTIFACTS/packages
    - mv build-release/*.sh $CIRCLE_ARTIFACTS/packages
    - mv build-release/*.tar.gz $CIRCLE_ARTIFACTS/packages
    - mv build-release/*.tar.Z $CIRCLE_ARTIFACTS/packages
